<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vanilla JS ìƒíƒœ ê´€ë¦¬</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
      }
      h1 {
        font-size: 3rem;
      }
      button {
        font-size: 1.5rem;
        margin: 10px;
        padding: 10px 20px;
      }
    </style>
  </head>
  <body>
    <div
      style="
        width: 20rem;
        height: 20rem;
        background-color: violet;
        justify-self: center;
        align-items: center;
        display: flex;
        flex-direction: row;
      "
    >
      <button id="increment">ì¦ê°€</button>
      <button id="decrement">ê°ì†Œ</button>
      <div id="counter"></div>
    </div>
    <script>
      const listeners = new Set();
      const subscribe = (listener) => {
        listeners.add(listener);
        console.log(`ë¦¬ìŠ¤ë„ˆ ë“±ë¡ë¨: ${listeners.size}`);

        return () => {
          listeners.delete(listener);
          console.log(`ë¦¬ìŠ¤ë„ˆ ì œê±°ë¨: ${listeners.size}`);
        };
      };

      // íŠ¹ì • ì¡°ê±´ì—ì„œ ì´ì „ì— ë“±ë¡ëœ ë¦¬ìŠ¤ë„ˆë¥¼ ì‚­ì œí•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©
      //useEffectì—ì„œ í´ë¦°ì—… í•¨ìˆ˜ë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒê³¼ ë¹„ìŠ·í•œ ì—­í• 
      const unsubscribe = subscribe(() => console.log("ìƒíƒœ ë³€ê²½ ê°ì§€ë¨"));

      unsubscribe();

      function useState(initialValue) {
        let state = initialValue;
        const listeners = new Set(); // ìƒíƒœê°€ ë³€ê²½ë  ë•Œ ì‹¤í–‰ë  í•¨ìˆ˜ë“¤ ì €ì¥

        const setState = (newState) => {
          if (state !== newState) {
            state = newState;
            listeners.forEach((listener) => listener(state)); // ì—°ê²°ëœ UI ì—…ë°ì´íŠ¸
          }
        };

        const subscribe = (listener) => {
          listeners.add(listener);
          return () => listeners.delete(listener); // êµ¬ë… ì·¨ì†Œ ê¸°ëŠ¥
        };

        return [() => state, setState, subscribe];
      }

      const [getCount, setCount, subscribeCount] = useState(0);

      const render = () => {
        document.getElementById("counter").innerText = getCount();
      };

      subscribeCount(render);

      document.getElementById("increment").addEventListener("click", () => {
        setCount(getCount() + 1);
      });

      document.getElementById("decrement").addEventListener("click", () => {
        setCount(getCount() - 1);
      });

      function useEffect(callback, dependencies) {
        let lastDependencies = [];

        const checkAndRun = () => {
          if (
            !dependencies ||
            dependencies.some((dep, i) => dep !== lastDependencies[i])
          ) {
            callback();
            lastDependencies = dependencies || [];
          }
        };

        checkAndRun();
        return checkAndRun;
      }
      useEffect(() => {
        console.log("ğŸ‰ Countê°€ ë³€ê²½ë¨:", getCount());
      }, [getCount()]); // getCount() ê°’ì´ ë³€ê²½ë  ë•Œ ì‹¤í–‰

      render();
    </script>
  </body>
</html>
